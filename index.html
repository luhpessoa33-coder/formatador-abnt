<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Acadêmico ABNT - Ipojuca Project</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <style>
        :root {
            --sidebar-width: 320px;
            --a4-width: 210mm;
            --a4-height: 297mm;
        }

        body { background-color: #1a1a1a; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        /* Estilização da Folha A4 */
        #editor-container {
            height: calc(100vh - 20px);
            overflow-y: auto;
            background: #333;
            padding: 40px 0;
            display: flex;
            justify-content: center;
        }

        #paper-A4 {
            width: var(--a4-width);
            min-height: var(--a4-height);
            padding: 3cm 2cm 2cm 3cm; /* Margens ABNT NBR 14724 */
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            margin-bottom: 50px;
            position: relative;
        }

        /* Sidebar */
        aside { height: 100vh; overflow-y: auto; background: #212529; }
        .x-small { font-size: 0.75rem; }
        .btn-xxs { padding: 4px 8px; font-size: 0.7rem; text-transform: uppercase; font-weight: bold; }
        
        #main-editor {
            border: none !important;
            font-family: 'Arial', sans-serif;
            font-size: 12pt;
            line-height: 1.5;
            height: auto;
            color: black;
        }

        .ql-toolbar { 
            position: sticky; top: 0; z-index: 1000; 
            background: #f8f9fa !important; border: none !important;
            border-bottom: 1px solid #ddd !important;
            display: flex; justify-content: center;
        }

        /* Checkbox Custom */
        .form-check-input:checked { background-color: #0dcaf0; border-color: #0dcaf0; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #222; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
    </style>
</head>
<body>

<div class="d-flex"> 
    <aside class="text-white p-3 shadow-lg" style="width: var(--sidebar-width);">
        <div class="text-center mb-4">
            <h5 class="text-info fw-bold mb-0">PROJETO IPOJUCA</h5>
            <small class="text-white-50">Editor de Dissertação ABNT</small>
        </div>

        <div class="mb-4 p-3 bg-black bg-opacity-50 rounded border border-warning">
            <h6 class="text-warning x-small fw-bold"><i class="fas fa-clock me-2"></i>CONTAGEM REGRESSIVA</h6>
            <input type="datetime-local" id="inputPrazo" class="form-control form-control-sm bg-dark text-white border-secondary mb-2">
            <div id="countdownDisplay" class="h4 text-center font-monospace text-warning">00:00:00</div>
        </div>

        <div class="mb-4 p-2 border border-secondary rounded bg-dark">
            <h6 class="text-info x-small fw-bold"><i class="fas fa-layer-group me-2"></i>FERRAMENTAS AHP</h6>
            <button class="btn btn-xxs btn-outline-info w-100 mb-2" onclick="inserirTabelaAHP()">Inserir Tabela de Pesos</button>
            <button class="btn btn-xxs btn-outline-warning w-100" onclick="inserirTextoResultados()">Inserir Intro Resultados</button>
        </div>

        <div class="mb-4">
            <h6 class="text-white-50 x-small fw-bold border-bottom border-secondary pb-1">PROGRESSO ABNT</h6>
            <div id="listaProgresso" class="x-small mt-2"></div>
        </div>

        <div class="mb-4">
            <h6 class="text-white-50 x-small fw-bold border-bottom border-secondary pb-1">SUMÁRIO DINÂMICO</h6>
            <div id="sumarioPreview" class="x-small text-white-50 mt-2" style="max-height: 150px; overflow-y: auto;">
                Aguardando títulos...
            </div>
        </div>

        <div class="mb-4">
            <h6 class="text-white-50 x-small fw-bold border-bottom border-secondary pb-1">FIGURAS E TABELAS</h6>
            <div id="listaIlustracoes" class="x-small text-white-50 mt-2">
                Nenhuma detectada.
            </div>
        </div>
    </aside>

    <main class="flex-grow-1">
        <div id="editor-container">
            <div id="paper-A4">
                <div id="main-editor">
                    <h1 style="text-align: center;">RESULTADOS E DISCUSSÃO</h1>
                    <p>Clique nos botões laterais para inserir os modelos de texto e tabelas para a Bacia do Rio Ipojuca.</p>
                </div>
            </div>
        </div>
    </main>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    // 1. Inicializar Quill
    var quill = new Quill('#main-editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, false] }],
                ['bold', 'italic', 'underline'],
                [{ 'align': [] }],
                ['image', 'clean']
            ]
        }
    });

    const STORAGE_KEY = 'dissertacao_ipojuca_v1';

    // 2. Tabela AHP Sugerida
    function inserirTabelaAHP() {
        const tabela = `
            <p style="text-align: center;"><strong>Tabela 1: Pesos dos subcritérios para a Bacia do Rio Ipojuca.</strong></p>
            <table style="width: 100%; border-collapse: collapse; border: 1px solid black;">
                <thead>
                    <tr style="border-top: 2px solid black; border-bottom: 1px solid black; background: #f2f2f2;">
                        <th style="padding: 8px; text-align: left;">Subcritério</th>
                        <th style="padding: 8px; text-align: center;">Peso (AHP)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;">Declividade</td><td style="text-align: center;">0.XX</td></tr>
                    <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;">Proximidade à Floresta</td><td style="text-align: center;">0.XX</td></tr>
                    <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;">Cobertura Vegetal</td><td style="text-align: center;">0.XX</td></tr>
                    <tr><td style="padding: 8px; border-bottom: 1px solid #ddd;">Proximidade a Nascentes</td><td style="text-align: center;">0.XX</td></tr>
                    <tr><td style="padding: 8px; border-bottom: 2px solid black;">Erodibilidade do Solo</td><td style="text-align: center;">0.XX</td></tr>
                </tbody>
            </table>
            <p style="font-size: 10pt;">Fonte: Elaborado pelo autor (2026).</p>
        `;
        quill.clipboard.dangerouslyPasteHTML(quill.getLength(), tabela);
    }

    // 3. Texto de Introdução aos Resultados
    function inserirTextoResultados() {
        const texto = `
            <h2>4. RESULTADOS</h2>
            <p>A aplicação da Análise Multicritério (AHP) permitiu a integração espacial dos cinco subcritérios selecionados para a Bacia do Rio Ipojuca. Através da normalização das variáveis físicas e ambientais, foi possível identificar áreas com diferentes potenciais para o Pagamento por Serviços Ambientais (PSA) Hídricos.</p>
            <p>Os critérios <strong>Declividade, Proximidade à Floresta, Cobertura Vegetal, Proximidade a Nascentes e Erodibilidade do Solo</strong> foram ponderados em matriz paritária, refletindo a importância da manutenção da qualidade e quantidade de água na bacia. A seguir, apresentam-se os mapas temáticos gerados e a síntese das áreas prioritárias.</p>
        `;
        quill.clipboard.dangerouslyPasteHTML(quill.getLength(), texto);
    }

    // 4. Funções de Salvamento e Interface
    function salvar() {
        const data = {
            html: quill.root.innerHTML,
            deadline: document.getElementById('inputPrazo').value,
            checks: Array.from(document.querySelectorAll('#listaProgresso input')).map(i => i.checked)
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function carregar() {
        const salvo = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if (salvo) {
            quill.root.innerHTML = salvo.html;
            document.getElementById('inputPrazo').value = salvo.deadline;
            iniciarTimer(salvo.deadline);
            // Restaurar checks após gerar lista
            setTimeout(() => {
                const checks = document.querySelectorAll('#listaProgresso input');
                salvo.checks.forEach((v, i) => { if(checks[i]) checks[i].checked = v; });
            }, 100);
        }
    }

    function iniciarTimer(data) {
        clearInterval(window.timer);
        window.timer = setInterval(() => {
            const diff = new Date(data) - new Date();
            if (diff < 0) {
                document.getElementById('countdownDisplay').innerText = "CONCLUÍDO";
                return;
            }
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('countdownDisplay').innerText = `${d}d ${h}h ${m}m ${s}s`;
        }, 1000);
    }

    // 5. Setup Inicial
    const itens = ["Capa/Folha Rosto", "Resumo/Abstract", "Introdução", "Metodologia AHP", "Resultados Ipojuca", "Discussão", "Referências"];
    const containerCheck = document.getElementById('listaProgresso');
    itens.forEach(it => {
        containerCheck.innerHTML += `<div class="form-check"><input class="form-check-input" type="checkbox" onchange="salvar()"> <label class="form-check-label">${it}</label></div>`;
    });

    quill.on('text-change', () => {
        salvar();
        const text = quill.getText();
        // Atualizar Ilustrações (simples)
        const figCount = (text.match(/Tabela|Figura/g) || []).length;
        document.getElementById('listaIlustracoes').innerText = `${figCount} elemento(s) detectado(s).`;
    });

    document.getElementById('inputPrazo').onchange = (e) => { iniciarTimer(e.target.value); salvar(); };
    window.onload = carregar;
</script>

</body>
</html>
